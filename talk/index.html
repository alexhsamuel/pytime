<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>It's about time</title>
    <link href="fonts" rel="stylesheet"> 
    <style>
      body {
        font-family: 'Roboto Condensed';
        font-weight: 400;
      }
      h1, h2, h3 {
        font-family: 'Roboto Condensed';
        font-weight: 700;
      }
      a, a:visited {
        color: black;
        text-decoration: none;
        border-bottom: 1px dashed #8080c0;
      }

      .remark-slide-content {
        font-size: 28px;
      }
      .remark-code, .remark-inline-code {
        font-family: 'Roboto Mono';
        font-weight: 400;
        font-size: 85%;
        color: #305060;
      }
      .remark-code-line {
        margin-left: 24px;
      }
      .remark-slide-scaler {
        width: 1024px !important;
        height: 576px !important;
      }

      .command {
        border: 2px solid #808080;
        background: #f0f0f0;
        padding: 1.4ex 1.5ex 1.5ex 1.5ex;
      }
      .comment {
        font-size: 85%;
        font-weight: 700;
        font-style: italics;
        color: #ab5018;
      }

      .advice {
        background: #f0f8ff;
        background-image: url('speech-balloon.png');
        background-size: 100px 80px;
        background-repeat: no-repeat;
        background-origin: border-box;
        background-position: right top;
      }
    </style>
  </head>
  <body>
    <textarea id="source">
class: center, middle
# It's about time
Alex Samuel

---
# Goals
- Present general concerns in handling time and date.
- Survey the options in Python.
- Discuss features, performance.

???
I signed up to do this talk because there are a bewildering array of options
for working with times and dates in Python.  I work with some of them on a 
regular bases, but there are others I have used only occasionally or not at all.

In order to force myself to evaluate all the choices currently out there,
I submitted to do this talk.

My goal is to bore you with the gory details of dealing with times, dates, and
time zones.  I'll stick to civil time as is widely used in business, and
won't go into leap seconds, relativistic effects, or astronomical time systems.

Also this is not a tutorial!  My goal is to help you to choose the best tool
for your work.

---
class: advice, middle
I will also give you some advice.

<div style="float: right;">
  <img src="grain-of-salt.jpg" style="width: 200px;">
  <br><span style="font-size: 60%;"><i>Fig 1. Grain of salt.</i></span>
</div>

Advice slides look like this.

They contain my _opinions_.

---
# Who am I?
- Writing Python since version 1.4.
- Used to work in high energy physics; now finance.
- Write lots of date and time code.

<svg class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
<a href="https://github.com/alexhsamuel" style="font-size: 90%;">alexhsamuel</a>
???
Who am I, so you can determine whether to heed my advice?

Now I work at Tudor Investment Corporation.

... where languish lots of uncompleted projects you've never heard of.

---
class: middle
# Preliminaries
???
Let's start by discussing some concepts.

---
# Time
- Like space except just one dimension.
- Increases monotonically.
???
What's time?

Without getting too philosophical, time is kind of like space except one
coordinate instead of three, and grows monotonically.  Basically pretty simple.

Mostly, in computer programs, we want to record the exact instant of time at
which a particular event happened, for example when a log line was recorded, or
when a user performed an action, or when some external event was measured, or
when a transaction occurred.

---
# Date
- Time is divided into days.
- A day is recurring span of (usually) 24 hours.
- Date specifies a day.
???
Humans have to complicate something as simple as this.

We traditionally specify time by first specifying a date, and then giving the 
time of day relative to the beginning of that date, using a bizarre set of units
called years, months, days, hours, minutes, and seconds.

---
# Time zones
<img src="Time-Zone-Map.gif" style="width: 85%;">
???
To complicate things further, we don't agree on when each day starts.  

Governments slice their territories into time zones, and appoint some time
offset to a reference time zone called UTC.

This offset may change during the year, due to daylight savings time.

Governments is free to change their minds about time zones, and they do so
regularly.

---
# Time zone database
<a href="https://www.iana.org/time-zones">Database</a> a.k.a. "Olson database".
- Linux, macOS: `/usr/share/zoneinfo`
- Windows: `tzres.dll`

Geographic names like "America/New_York".
???
Fortunately, the selfless souls at IANA maintain a database of historical,
current, and projected time zones offsets. 

Often called the "Olson database".

---
# Time formats

[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)
/ [RFC 3339](https://tools.ietf.org/html/rfc3339):

<div class="center" style="background: gold; font-weight: 700;">2017-11-25T21:01:30+00:00</div>

Also:
<pre style="font-size: 85%;">
2017-11-25 16:01:30 -05:00
2017/11/25 16:01:30
11/25/17 16:01:30
2017 November 25 16:01:39
Sat, 25 Nov 2017 16:01:39 -0500
sábado 25 noviembre 2017 16:01:03
...
</pre>
???
There are countless variations on how to format times and dates as strings.

For user interfaces, you may have to support a variety of region-, culture-, and
language-specific formats.

For computers, there is a standard family of formats called ISO 8601, and a
more specific standard RFC 3339.

Sometimes you'll see a "Z" suffix instead of +00:00 to specify UTC.

---
class: advice, middle
Use RFC 3339 time format in APIs and data files.
???
User interfaces for nontechnical users will need more human-centric formats.

---
class: middle
# Python representations
???
1. primitive representations
2. datetime & friends
3. datetime derivatives
4. data representations

---
# Primitive
- string times and dates: 
    - `"2017-11-25"` 
    - `"2017-11-25T16:01:30+00:00"`
- integer-encoded strings:
    - `20171125`

<br>
```py
date = 10000 * year + 100 * month + day    # ☹
```
???
The chief benefit of these is that they work with all languages, frameworks,
and file formats.

But, there are basically no time operations you can perform on these
representations.

---
class: advice, middle

Use RFC 3339 strings for simple formats: CSV, JSON, ...

Don't use strings internally if you perform _any_ time operations.

Don't use integer-encoded times and dates.

---
# Tick representations
Choose a starting time ("epoch") and a unit, and count ticks.
```py
# seconds since 1970-01-01T00:00:00+00:00
>>> time.time()
1511734953.8993392  
```
???
UNIX, and Python, traditionally use UTC midnight on Jan 1, 1970 as the epoch.

This is closest to the physical meaning of dates.  Simple.  Clear.  When one
second elapses, this number increases by 1.

If it weren't for humans and their idiosyncrasies, this would be my last slide.

Unfortunately, we are humans.

---
# [datetime](https://docs.python.org/3/library/datetime.html)

The standard library `datetime` package solves many of our problems.

A time (an instance of the `datetime` class) can be,
  - _naive_, without time zone
  - _localized_, with time zone 
???
Stores times as year, month, day, hour, minute, second, microsecond components.
Resolution is 1 µs.  

Implemented in C and rather efficient.

---
class: advice, middle
Time zones are complicated.

Use UTC internally, and convert to other time zones in UIs.
???
Some choose to use naive datetimes and always store UTC.  

IMO, this becomes confusing if you ever have to use localized datetimes for
the UI, so I prefer datetimes localized to UTC.

---
class: middle
```py
>>> t = datetime.utcnow()
>>> t.year, t.month, t.day
(2017, 11, 26)
>>> t.date()
datetime.date(2017, 11, 26)
```
Formatting and parsing per C library `strptime()` / `strftime()`.
```py
>>> t = datetime(2017, 11, 26, 17, 45, 37)
>>> format(t, "%Y-%m-%dT%H:%M:%S")
'2017-11-26T17:45:37'
```
???
Participates nicely with Python's string formatting.

---
class: advice, middle

Don't use a time to represent a date.
???
Dates are fundamentally different objects, with different operations they can
participate in.

Some systems represent dates as the time at midnight on that date.  Python
gives you a date type.  Use it.

---
# Shortcomings of datatime
- `tzinfo` interface but no concrete time zones
- limited convenience functions and utilities
- 1 µs resolution 
???
One approach is to address these shortcomings with different libraries.
---
# datetime + [pytz](http://pythonhosted.org/pytz/)
- Includes a recent copy of the time zone database.
- Implements `tzinfo`.

```py
>>> tz = pytz.timezone("America/New_York")
>>> tz.localize(datetime.now())
datetime.datetime(2017, 11, 26, 18, 1, 6, 620221,
  tzinfo=<DstTzInfo 'America/New_York' EST-1 day, 
          19:00:00 STD>)
```
???
datetime.now() returns a naive datetime; the time zone's localize method
converts it to a localized datetime.

---
# datetime + [dateutil](https://dateutil.readthedocs.io/en/stable/)
- Implements `tzinfo` using the system time zone database.
- Also includes a copy of the time zone database.

```py
>>> tz = dateutil.tz.gettz("America/New_York")
```

- Convenient parsing.

```py
>>> dateutil.parser.parse("2017 Nov 1 9:15:00 UTC")
datetime.datetime(2017, 11, 1, 9, 15, 
    tzinfo=tzutc())
```
???
An oldie but goodie.

Also provides some recurrence / calendar functionality, which I won't get into
here, plus calculation of Easter, which is a historically interesting problem.

---
# datetime + [Babel](http://babel.pocoo.org/en/latest/)
An internationalization library with time and date support.
```py
>>> babel.dates.format_datetime(t, locale="zh")
'2017年11月26日 下午11:32:31'
```

???

    </textarea>
    <script src="remark-latest.min.js"></script>
    <script>
      const slideshow = remark.create()
    </script>
  </body>
</html>

      
